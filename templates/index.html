<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewsWeave Infinity | Deployable AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f3ff; --dark: #050505; --glass: rgba(20, 20, 20, 0.85); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Rajdhani', sans-serif; }
        
        body { background: var(--dark); color: #fff; overflow-x: hidden; min-height: 100vh; }
        
        /* CYBERPUNK BACKGROUND */
        .bg-anim {
            position: fixed; top:0; left:0; width:100%; height:100%; z-index:-1;
            background: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #000 100%);
        }
        .grid-lines {
            position: absolute; width: 100%; height: 100%;
            background-image: linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
        }
        @keyframes gridMove { 0% { transform: translateY(0); } 100% { transform: translateY(50px); } }

        /* UI CONTAINER */
        .app-container { max-width: 1200px; margin: 0 auto; padding: 20px; display: flex; flex-direction: column; align-items: center; }

        /* HEADER & STATS */
        .header { margin-top: 10vh; text-align: center; width: 100%; }
        .logo { font-family: 'Orbitron', sans-serif; font-size: 4rem; text-shadow: 0 0 20px var(--neon); letter-spacing: 5px; margin-bottom: 10px; }
        .tagline { color: #888; letter-spacing: 2px; text-transform: uppercase; font-size: 1.2rem; }

        .stat-badge {
            margin-top: 20px;
            display: inline-flex; align-items: center; gap: 10px;
            background: rgba(0, 243, 255, 0.1);
            border: 1px solid var(--neon);
            padding: 8px 20px; border-radius: 4px;
            font-size: 1.1rem;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        .stat-badge i { color: #ff2a6d; animation: beat 1.5s infinite; }
        @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); } }

        /* CONTROL PANEL */
        .control-panel {
            width: 100%; max-width: 900px; margin-top: 50px;
            background: var(--glass); border: 1px solid #333;
            padding: 20px; border-radius: 10px;
            display: flex; gap: 10px; flex-wrap: wrap;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }

        .input-group { flex: 1; min-width: 300px; position: relative; }
        .main-input {
            width: 100%; padding: 15px 20px;
            background: #000; border: 1px solid #444; color: var(--neon);
            font-size: 1.3rem; outline: none; transition: 0.3s;
        }
        .main-input:focus { border-color: var(--neon); box-shadow: 0 0 15px rgba(0, 243, 255, 0.2); }

        .select-group { display: flex; gap: 10px; }
        .cyber-select {
            background: #111; color: #fff; border: 1px solid #444;
            padding: 10px; font-size: 1rem; cursor: pointer; outline: none;
        }
        
        .btn-launch {
            background: var(--neon); color: #000; border: none;
            padding: 0 30px; font-weight: 900; font-size: 1.2rem;
            cursor: pointer; transition: 0.3s;
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }
        .btn-launch:hover { background: #fff; box-shadow: 0 0 30px var(--neon); }

        /* RESULTS MATRIX */
        .results-matrix {
            width: 100%; max-width: 1400px; margin-top: 40px;
            display: grid; grid-template-columns: 35% 65%; gap: 20px;
            opacity: 0; transform: translateY(20px); transition: 0.5s;
        }
        .results-matrix.active { opacity: 1; transform: translateY(0); }

        /* LEFT: REPORT */
        .report-box {
            background: var(--glass); border: 1px solid var(--neon);
            padding: 30px; height: 80vh; overflow-y: auto;
            position: relative;
        }
        .report-content { font-size: 1.1rem; line-height: 1.7; color: #ddd; }
        .report-content h1 { font-family: 'Orbitron'; color: var(--neon); font-size: 1.8rem; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .report-content h3 { color: #fff; margin: 25px 0 10px; background: rgba(255,255,255,0.05); padding: 5px; border-left: 3px solid var(--neon); }
        .report-content a { color: #ff2a6d; text-decoration: none; font-weight: bold; }

        /* LIKE BUTTON IN REPORT */
        .like-btn {
            position: absolute; top: 20px; right: 20px;
            background: transparent; border: 1px solid #ff2a6d; color: #ff2a6d;
            padding: 5px 15px; cursor: pointer; font-size: 0.9rem; transition: 0.3s;
        }
        .like-btn:hover, .like-btn.active { background: #ff2a6d; color: white; box-shadow: 0 0 15px #ff2a6d; }

        /* RIGHT: IMAGES */
        .visual-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px; height: 80vh; overflow-y: auto; padding-right: 5px;
        }
        .v-card {
            border: 1px solid #333; height: 200px; position: relative; overflow: hidden;
            transition: 0.3s; cursor: pointer;
        }
        .v-card:hover { border-color: var(--neon); transform: scale(0.98); }
        .v-card img { width: 100%; height: 100%; object-fit: cover; }
        
        /* LOADER */
        .loader {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); z-index: 1000;
            display: none; align-items: center; justify-content: center;
            flex-direction: column;
        }
        .scan-line {
            width: 300px; height: 4px; background: var(--neon);
            box-shadow: 0 0 20px var(--neon);
            animation: scan 2s infinite ease-in-out;
        }
        .loading-text { margin-top: 20px; color: var(--neon); font-family: 'Orbitron'; letter-spacing: 2px; }
        @keyframes scan { 0% { width: 0; } 50% { width: 300px; } 100% { width: 0; } }

        /* MOBILE */
        @media (max-width: 900px) {
            .results-matrix { grid-template-columns: 1fr; }
            .control-panel { flex-direction: column; }
            .select-group { flex-direction: column; }
        }
    </style>
</head>
<body>

    <div class="bg-anim"><div class="grid-lines"></div></div>

    <div class="app-container">
        
        <div class="header">
            <div class="logo">NEWSWEAVE</div>
            <div class="tagline">INFINITY INTELLIGENCE ENGINE V13</div>
            
            <div class="stat-badge">
                <i class="fas fa-heart"></i>
                <span id="likes-count">Initializing...</span>
                <span>USERS ATTRACTED</span>
            </div>
        </div>

        <div class="control-panel">
            <div class="input-group">
                <input type="text" id="topic" class="main-input" placeholder="Enter Command / Topic...">
            </div>
            
            <div class="select-group">
                <select id="region-selector" class="cyber-select">
                    <option value="wt-wt|English (Global)" selected>ğŸŒ Global (English)</option>
                    <option value="us-en|English (USA)">ğŸ‡ºğŸ‡¸ USA</option>
                    <option value="in-en|English (India)">ğŸ‡®ğŸ‡³ India (English)</option>
                    <option value="in-hi|Hindi">ğŸ‡®ğŸ‡³ India (Hindi)</option>
                    <option value="cn-zh|Chinese">ğŸ‡¨ğŸ‡³ China (Mandarin)</option>
                    <option value="es-es|Spanish">ğŸ‡ªğŸ‡¸ Spain (Spanish)</option>
                    <option value="mx-es|Spanish (Mexico)">ğŸ‡²ğŸ‡½ Mexico</option>
                    <option value="fr-fr|French">ğŸ‡«ğŸ‡· France</option>
                    <option value="de-de|German">ğŸ‡©ğŸ‡ª Germany</option>
                    <option value="jp-jp|Japanese">ğŸ‡¯ğŸ‡µ Japan</option>
                    <option value="ru-ru|Russian">ğŸ‡·ğŸ‡º Russia</option>
                    <option value="br-pt|Portuguese">ğŸ‡§ğŸ‡· Brazil</option>
                    <option value="ae-ar|Arabic">ğŸ‡¦ğŸ‡ª UAE (Arabic)</option>
                    <option value="kr-kr|Korean">ğŸ‡°ğŸ‡· South Korea</option>
                    <option value="it-it|Italian">ğŸ‡®ğŸ‡¹ Italy</option>
                    <option value="nl-nl|Dutch">ğŸ‡³ğŸ‡± Netherlands</option>
                    <option value="se-sv|Swedish">ğŸ‡¸ğŸ‡ª Sweden</option>
                    <option value="tr-tr|Turkish">ğŸ‡¹ğŸ‡· Turkey</option>
                    <option value="id-id|Indonesian">ğŸ‡®ğŸ‡© Indonesia</option>
                    <option value="pl-pl|Polish">ğŸ‡µğŸ‡± Poland</option>
                    </select>

                <select id="mode" class="cyber-select">
                    <option value="Deep Research">ğŸ§  Deep Mind</option>
                    <option value="Fact Check">ğŸ›¡ï¸ Verify Truth</option>
                    <option value="Market Analysis">ğŸ“ˆ Market Data</option>
                    <option value="Creative">ğŸ¨ Creative</option>
                </select>
            </div>

            <button class="btn-launch" onclick="ignite()">EXECUTE</button>
        </div>

        <div class="results-matrix" id="matrix">
            <div class="report-box">
                <button class="like-btn" id="like-btn" onclick="sendLike()">
                    <i class="fas fa-heart"></i> Like Result
                </button>
                <div class="report-content" id="report-text"></div>
            </div>

            <div class="visual-grid" id="img-grid"></div>
        </div>

    </div>

    <div class="loader" id="loader">
        <div class="scan-line"></div>
        <div class="loading-text">ACCESSING SATELLITE FEEDS...</div>
    </div>

    <script>
        // ON LOAD: Get Stats
        window.addEventListener('load', async () => {
            try {
                const res = await fetch('/stats');
                const data = await res.json();
                document.getElementById('likes-count').innerText = data.likes.toLocaleString();
            } catch(e) { console.log('Stats offline'); }
        });

        async function ignite() {
            const topic = document.getElementById('topic').value;
            const regionData = document.getElementById('region-selector').value.split('|');
            const regionCode = regionData[0];
            const langName = regionData[1];
            const mode = document.getElementById('mode').value;

            if(!topic) return alert("INPUT REQUIRED");

            // UI State
            document.getElementById('loader').style.display = 'flex';
            document.getElementById('matrix').classList.remove('active');
            
            // Reset Like Button
            const likeBtn = document.getElementById('like-btn');
            likeBtn.classList.remove('active');
            likeBtn.innerHTML = '<i class="fas fa-heart"></i> Like Result';
            likeBtn.disabled = false;

            try {
                const res = await fetch('/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ topic, region_code: regionCode, language_name: langName, mode })
                });

                const data = await res.json();

                // Inject Text
                document.getElementById('report-text').innerHTML = data.report;

                // Inject Images
                const grid = document.getElementById('img-grid');
                grid.innerHTML = '';
                if(data.images.length > 0) {
                    data.images.forEach(img => {
                        grid.innerHTML += `<div class="v-card" onclick="window.open('${img.src}', '_blank')"><img src="${img.src}" onerror="this.parentElement.style.display='none'"></div>`;
                    });
                } else {
                    grid.innerHTML = '<p style="padding:20px; color:#666;">No verified images found in this sector.</p>';
                }

                // Show
                document.getElementById('loader').style.display = 'none';
                document.getElementById('matrix').classList.add('active');

            } catch(e) {
                document.getElementById('loader').style.display = 'none';
                alert("SYSTEM FAILURE. CHECK CONNECTION.");
            }
        }

        async function sendLike() {
            const btn = document.getElementById('like-btn');
            if(btn.disabled) return;

            try {
                const res = await fetch('/like', {method: 'POST'});
                const data = await res.json();
                
                // Update Global Counter
                document.getElementById('likes-count').innerText = data.likes.toLocaleString();
                
                // Update Button
                btn.innerHTML = 'Liked <i class="fas fa-check"></i>';
                btn.classList.add('active');
                btn.disabled = true;
            } catch(e) { console.log('Like failed'); }
        }

        // Enter Key
        document.getElementById('topic').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') ignite();
        });
    </script>
</body>
</html>
